# ğŸ“š Paper RAG Roadmap

## ğŸ¯ Objective
- Project chats (workspace mode)
- Scope-based chats (PDFs / tags / mixed)
- Inline backreferencing (@ attach paper)
- Minimal metadata duplication
- Clean, future-proof storage

---

## Phase 1 â€” Foundations

### 1. Document Registry in ChromaDB

One row per chunk
- [x] doc_id (UUID) 
- [x] title
- [x] content_hash (unique)
- [x] tags
- published_at (nullable)
- project_ids (many-to-many)

### 2. Chunk Embeddings (Chroma)
Per chunk:
- id = "{doc_id}:{chunk_index}"
- metadata:
  - doc_id
  - chunk_index
  - page_start
  - page_end

Keep chunk metadata minimal.

### 3. Core Retrieval Primitive
All segmentation compiles into:

search(query, allowed_doc_ids=[...])

### 4. Chat Routing

Implement 3 classes:

1. FAST_FACT (direct answer within scope or memory)
2. NORMAL_RAG (validated answer within scope)
3. DEEP_RESEARCH (validated answer in DB)

Retrieval primitive: `search(query, allowed_doc_ids=[...])`

Fallback: fast â†’ normal â†’ deep

---

## Phase 2 â€” Segmentation

### 4. Tags
- Add/edit tags in registry
- Resolve tags â†’ doc_ids
- â€œChat with tag(s)â€ start flow

### 5. Projects (Workspace Mode)
- projects table
- doc_projects many-to-many
- â€œNew chat in projectâ€
- Default scope = project docs only (strict)

---

## Phase 3 â€” Scope System

### 6. Saved Scopes

Definition example:
```json
{
  project_ids: [],
  tags: [],
  doc_ids: [],
  strict: true,
  expand_global: false
}
```

Chats reference scope_id.

### 7. Research Chat Mode + Reader Mode
Start from:
- Single PDF
- Multiple PDFs
- Tags
- Mixed sources

Scope editable + saveable.

---

## Phase 4 â€” Working Set

### 8. Working Set Attachments
Per chat:
- attached_doc_ids
- optional pinned_chunk_ids

Retrieval rule:
allowed_doc_ids = scope_docs âˆª working_set_docs

### 9. Inline @ Mention
- Search docs by title/tags
- Attach to working set
- If outside scope â†’ mark â€œImportedâ€

---

## Phase 5 â€” Hybrid Retrieval and Memory

### 10. Hybrid Mode
- Primary pool: scope docs
- Secondary pool: related global docs (lower weight)
- Merge + rerank
- Section-aware chunking
- Cross-encoder reranker

### 11. Memory 
- Implement in-house memory/cache 



